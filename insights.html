<!doctype html>
<html lang="en-IN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Insights — RK Estates</title>
  <meta name="description" content="On-the-ground market notes from RK Estates across Defence Colony, Vasant Vihar, Westend, Panchsheel, GK, LBZ & Gurgaon. Clear, data-led guidance for high-stakes decisions." />

  <!-- Open Graph -->
  <meta property="og:title" content="Insights — RK Estates" />
  <meta property="og:description" content="Market notes and updates for South Delhi & Gurgaon — verified, on-the-ground, and practical." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/insights.html" />
  <meta property="og:image" content="/favicon.png" />

  <link rel="icon" href="/favicon.png" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Fonts + Tailwind -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { navy:'#0e1421', royal:'#2563eb' },
          fontFamily: { sans:['Inter','ui-sans-serif','system-ui'], serif:['Playfair Display','ui-serif'] },
          boxShadow: { 'ring-royal':'0 0 0 2px #2563eb33' }
        }
      }
    }
<script>
  // Mobile nav
  const menuBtn = document.getElementById('menuBtn');
  const mobileNav = document.getElementById('mobileNav');
  if (menuBtn && mobileNav) menuBtn.addEventListener('click', () => mobileNav.classList.toggle('hidden'));

  // ---------- Helpers ----------
  const fmtDate = iso => {
    const d = new Date(iso);
    return isNaN(d) ? iso : d.toLocaleDateString('en-IN', { day:'2-digit', month:'short', year:'numeric' });
  };
  const norm = p => {
    if (!p) return '';
    if (/^https?:\/\//i.test(p)) return p;  // absolute URL
    return p.replace(/^\/+/, '');           // strip leading slash so we can safely prefix with /
  };

  // ---------- DOM ----------
  const hero    = document.getElementById('hero');
  const filters = document.getElementById('filters');
  const cards   = document.getElementById('cards');
  const empty   = document.getElementById('empty');

  // ---------- Templates ----------
  const cardHTML = item => {
    const img  = item.image ? `<img src="/${norm(item.image)}" alt="${item.title}" class="h-40 w-full object-cover" loading="lazy">` : '';
    const link = item.link ? `/${norm(item.link)}` : '#';
    return `
      <article class="rounded-2xl border border-white/10 bg-white/5 overflow-hidden hover:bg-white/[.07] transition">
        ${img}
        <div class="p-5">
          <div class="text-xs text-white/55">${fmtDate(item.date)}</div>
          <h3 class="mt-1 text-lg font-semibold">${item.title}</h3>
          <p class="mt-2 text-sm text-white/70 clamp-3">${item.summary || ''}</p>
          <a href="${link}" class="inline-block mt-4 text-sm text-royal hover:underline">Read more →</a>
        </div>
      </article>
    `;
  };

  const heroHTML = item => {
    const img  = item.image ? `<img src="/${norm(item.image)}" alt="${item.title}" class="w-full h-64 object-cover rounded-t-2xl">` : '';
    const link = item.link ? `/${norm(item.link)}` : '#';
    return `
      <div class="border border-white/10 bg-white/5 rounded-2xl overflow-hidden hover:bg-white/[.07] transition">
        ${img}
        <div class="p-6">
          <div class="text-xs text-white/55">${fmtDate(item.date)}</div>
          <h2 class="mt-1 text-2xl font-semibold">${item.title}</h2>
          <p class="mt-3 text-white/70">${item.summary || ''}</p>
          <a href="${link}" class="mt-4 inline-block text-sm text-royal hover:underline">Read the full report →</a>
        </div>
      </div>
    `;
  };

  const pretty = s => s === 'marketWatch' ? 'Market Watch' : (s === 'nri' ? 'NRIs' : 'Buyers');

  const renderCards = (list, aud) => {
    cards.innerHTML = '';
    const filtered = aud === 'all' ? list : list.filter(i => i.audience === aud);
    filtered.sort((a,b) => new Date(b.date) - new Date(a.date));
    filtered.forEach(i => cards.insertAdjacentHTML('beforeend', cardHTML(i)));
    empty.classList.toggle('hidden', filtered.length > 0);
  };

  const renderFilters = audiences => {
    filters.innerHTML =
      `<button data-audience="all" class="px-3 py-1 rounded-md border border-white/20 text-sm hover:bg-white/10">All</button>` +
      audiences.map(a =>
        `<button data-audience="${a}" class="ml-2 px-3 py-1 rounded-md border border-white/20 text-sm hover:bg-white/10">${pretty(a)}</button>`
      ).join('');
  };

  // ---------- Init ----------
  (function init() {
    const url = `/assets/insights.json?v=${Date.now()}`; // cache-bust to avoid stale fetch
    fetch(url)
      .then(r => {
        if (!r.ok) throw new Error(`HTTP ${r.status} for ${url}`);
        return r.json();
      })
      .then(list => {
        if (!Array.isArray(list) || !list.length) {
          console.error('insights.json is empty or not an array');
          empty.textContent = 'No articles found.';
          empty.classList.remove('hidden');
          return;
        }

        const pinned   = list.find(i => i && i.pinned);
        const articles = list.filter(i => i && !i.pinned);

        if (pinned) hero.innerHTML = heroHTML(pinned);

        const audiences = [...new Set(articles.map(i => i.audience))].filter(Boolean);
        renderFilters(audiences.length ? audiences : ['buyers','nri','marketWatch'].filter(a =>
          articles.some(i => i.audience === a)
        ));
        renderCards(articles, 'all');

        filters.addEventListener('click', (e) => {
          const btn = e.target.closest('button[data-audience]');
          if (!btn) return;
          renderCards(articles, btn.getAttribute('data-audience'));
        });
      })
      .catch(err => {
        console.error('Failed to load insights.json:', err);
        empty.textContent = 'Could not load /assets/insights.json';
        empty.classList.remove('hidden');
      });
  })();
</script>
